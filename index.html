<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZenStream</title>
    <style>
        :root {
            --bg: #000000;
            --surface: #1C1C1E; /* iOS Dark Gray */
            --primary: #FF9500; /* Audible Orange */
            --text: #ffffff;
            --text-sec: #8E8E93;
            --border: #2C2C2E;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); color: var(--text);
            display: flex; flex-direction: column; height: 100vh;
            overflow: hidden; /* Prevent scrolling away from player */
        }

        /* --- HEADER --- */
        .header {
            padding: 15px 20px; text-align: center;
            border-bottom: 1px solid var(--border);
            font-weight: 600; letter-spacing: -0.5px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .header span { color: var(--primary); }

        /* --- SEARCH BAR --- */
        .search-area { padding: 15px 20px; }
        .input-box {
            display: flex; background: var(--surface);
            border-radius: 10px; padding: 8px 12px; align-items: center;
        }
        input {
            flex: 1; background: transparent; border: none; color: white;
            font-size: 16px; padding: 5px; outline: none;
        }
        .btn-go {
            color: var(--primary); font-weight: bold; border: none;
            background: transparent; padding: 5px 10px; cursor: pointer;
        }

        /* --- PLAYER CONTAINER --- */
        .player-container {
            flex: 1; display: flex; flex-direction: column;
            justify-content: center; padding: 0 20px;
        }
        
        .video-wrapper {
            width: 100%; aspect-ratio: 16/9; background: #111;
            border-radius: 12px; overflow: hidden; box-shadow: 0 10px 40px rgba(255,149,0, 0.1);
        }
        #yt-player { width: 100%; height: 100%; }

        /* --- INFO & CONTROLS --- */
        .track-info { margin-top: 25px; text-align: center; }
        .track-title { font-size: 18px; font-weight: 600; margin-bottom: 5px; line-height: 1.3; }
        .track-artist { color: var(--text-sec); font-size: 15px; }

        /* --- ACTION BUTTONS (Sleep Timer) --- */
        .controls-row {
            display: flex; justify-content: center; margin-top: 30px; gap: 40px;
            margin-bottom: 40px;
        }
        .icon-btn {
            background: none; border: none; color: var(--text);
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            font-size: 12px; color: var(--text-sec); cursor: pointer;
        }
        .icon-btn svg { width: 28px; height: 28px; fill: var(--text); }
        .icon-btn.active svg { fill: var(--primary); }
        .icon-btn.active { color: var(--primary); }

        /* --- SLEEP TIMER MODAL (Audible Style) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); z-index: 100;
            display: none; align-items: flex-end; /* Slide up from bottom */
        }
        .modal-sheet {
            background: var(--surface); width: 100%; border-radius: 20px 20px 0 0;
            padding: 20px 0 40px; animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .modal-header {
            text-align: center; font-weight: 600; font-size: 16px; margin-bottom: 20px;
            padding-bottom: 15px; border-bottom: 1px solid var(--border); color: var(--text-sec);
        }
        
        .timer-options { display: flex; flex-direction: column; }
        .timer-opt {
            padding: 15px 30px; font-size: 18px; color: white; background: none; border: none;
            text-align: left; cursor: pointer; border-bottom: 1px solid #252525;
        }
        .timer-opt:active { background: #333; }
        
        .cancel-btn {
            margin: 20px 20px 0; background: #333; color: white; padding: 15px;
            border-radius: 12px; font-weight: 600; border: none; width: calc(100% - 40px);
        }

        /* --- ACTIVE TIMER DISPLAY --- */
        .timer-active-display {
            font-variant-numeric: tabular-nums;
            font-size: 14px; font-weight: 600; color: var(--primary);
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="header">
        <div>Zen<span>Stream</span></div>
    </div>

    <div class="search-area">
        <div class="input-box">
            <input type="text" id="urlInput" placeholder="Paste YouTube Link or ID">
            <button class="btn-go" onclick="loadVideo()">PLAY</button>
        </div>
    </div>

    <div class="player-container">
        <div class="video-wrapper">
            <div id="yt-player"></div>
        </div>

        <div class="track-info">
            <div class="track-title" id="vidTitle">Ready to Play</div>
            <div class="track-artist" id="vidAuthor">Paste a link above</div>
        </div>

        <div class="controls-row">
            <button class="icon-btn" onclick="openTimerModal()" id="sleepBtn">
                <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-.22-13h-.06c-.4 0-.72.32-.72.72v4.72l2.85 2.85c.28.28.74.28 1.02 0 .28-.28.28-.74 0-1.02l-2.37-2.37V7.72c0-.4-.32-.72-.72-.72z"/></svg>
                <span>Sleep Timer</span>
                <div class="timer-active-display" id="timerDisplay" style="display:none">00:00</div>
            </button>
        </div>
    </div>

    <div class="modal-overlay" id="timerModal" onclick="closeTimerModal(event)">
        <div class="modal-sheet">
            <div class="modal-header">Set Sleep Timer</div>
            <div class="timer-options">
                <button class="timer-opt" onclick="setTimer(8)">8 minutes</button>
                <button class="timer-opt" onclick="setTimer(15)">15 minutes</button>
                <button class="timer-opt" onclick="setTimer(30)">30 minutes</button>
                <button class="timer-opt" onclick="setTimer(45)">45 minutes</button>
                <button class="timer-opt" onclick="setTimer(60)">60 minutes</button>
                <button class="timer-opt" onclick="setTimer(0)">Off</button>
            </div>
            <button class="cancel-btn" onclick="document.getElementById('timerModal').style.display='none'">Close</button>
        </div>
    </div>

    <script>
        // --- 1. YOUTUBE API INIT ---
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('yt-player', {
                height: '100%', width: '100%',
                videoId: '',
                playerVars: {
                    'playsinline': 1, // iOS Background Play Requirement
                    'controls': 1,
                    'modestbranding': 1,
                    'fs': 0
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // --- 2. LOAD VIDEO ---
        function loadVideo() {
            let val = document.getElementById('urlInput').value;
            // Extract ID logic
            let id = val.match(/(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\&v=))([\w-]{11})/);
            let videoId = id ? id[1] : val; // If input is just ID, use it

            if(videoId.length === 11) {
                player.loadVideoById(videoId);
                document.getElementById('vidTitle').innerText = "Loading Metadata...";
                document.getElementById('vidAuthor').innerText = "Please wait";
                
                // Hacky title fetch (since we don't have Data API here)
                // Real app would use oEmbed or API key
                setTimeout(() => {
                    let data = player.getVideoData();
                    if(data && data.title) {
                        document.getElementById('vidTitle').innerText = data.title;
                        document.getElementById('vidAuthor').innerText = data.author || "YouTube Video";
                        
                        // Setup Media Session (Lock Screen Controls)
                        if ('mediaSession' in navigator) {
                            navigator.mediaSession.metadata = new MediaMetadata({
                                title: data.title,
                                artist: data.author || "ZenStream",
                                artwork: [{ src: 'https://img.youtube.com/vi/'+videoId+'/0.jpg', sizes: '512x512', type: 'image/jpeg' }]
                            });
                        }
                    }
                }, 2000);
            } else {
                alert("Invalid Link");
            }
        }

        // --- 3. BACKGROUND PLAY HELPER ---
        function onPlayerStateChange(event) {
            // When video plays, we tell the browser "We are active"
            if (event.data == YT.PlayerState.PLAYING) {
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = "playing";
                }
            } else {
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = "paused";
                }
            }
        }

        // --- 4. SLEEP TIMER LOGIC ---
        let timerInterval;
        let endTime;

        function openTimerModal() {
            document.getElementById('timerModal').style.display = 'flex';
        }

        function closeTimerModal(e) {
            if(e.target.id === 'timerModal') {
                document.getElementById('timerModal').style.display = 'none';
            }
        }

        function setTimer(minutes) {
            document.getElementById('timerModal').style.display = 'none';
            clearInterval(timerInterval);

            if(minutes === 0) {
                // Cancel Timer
                document.getElementById('sleepBtn').classList.remove('active');
                document.getElementById('timerDisplay').style.display = 'none';
                return;
            }

            // Start Timer
            const now = new Date().getTime();
            endTime = now + (minutes * 60 * 1000);
            
            document.getElementById('sleepBtn').classList.add('active');
            document.getElementById('timerDisplay').style.display = 'block';
            
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const now = new Date().getTime();
            const distance = endTime - now;

            if (distance < 0) {
                clearInterval(timerInterval);
                document.getElementById('timerDisplay').innerText = "00:00";
                fadeOutAndStop();
            } else {
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById('timerDisplay').innerText = 
                    (m < 10 ? "0"+m : m) + ":" + (s < 10 ? "0"+s : s);
            }
        }

        function fadeOutAndStop() {
            // Smooth volume fade out
            let vol = player.getVolume();
            let fade = setInterval(() => {
                vol = vol - 5;
                if(vol <= 0) {
                    clearInterval(fade);
                    player.pauseVideo();
                    player.setVolume(100); // Reset for next time
                    // Reset UI
                    document.getElementById('sleepBtn').classList.remove('active');
                    document.getElementById('timerDisplay').style.display = 'none';
                } else {
                    player.setVolume(vol);
                }
            }, 200); // Reduce volume every 200ms
        }
    </script>
</body>
</html>

